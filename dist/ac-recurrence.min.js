!function(){"use strict";angular.module("ac-recurrence",["angular.filter"])}(),function(){"use strict";angular.module("ac-recurrence").constant("RRule",RRule)}(),angular.module("ac-recurrence").run(["$templateCache",function(e){e.put("ac-grid.html",'<div class="outer">\n  <div class="vis-hidden" ng-repeat="row in ::options | chunkBy : perRow">\n    <input id="{{\'cell-\' + $id}}" ng-model="selections[cell.value]" type="checkbox" ng-repeat-start="cell in row">\n    <label for="{{\'cell-\' + $id }}" ng-repeat-end>{{ cell.label }}</label>\n  </div>\n</div>\n'),e.put("ac-recurrence.html",'<div ng-form>\n  <fieldset>\n    <label>Frequency</label>\n    <select ng-model="vm.properties.frequency" ng-change="vm.setFrequency()">\n      <option value="3">daily</option>\n      <option value="2">weekly</option>\n      <option value="1">monthly</option>\n      <option value="0">yearly</option>\n    </select>\n\n    <div>\n      <label>Every</label>\n      <input type="number" ng-model="vm.properties.interval" min="1"></input>\n      <label>{{ vm.word }}<ng-pluralize count="vm.properties.interval" when="{ 1: \'\', other: \'s\'}"></ng-pluralize>{{ vm.preposition }}</label>\n    </div>\n\n    <ac-grid ng-if="vm.properties.frequency === \'2\'" ng-model="vm.properties.byWeekDay" options="vm.days" per-row="7"></ac-grid>\n    <ac-grid ng-if="vm.properties.frequency === \'0\'" ng-model="vm.properties.byMonth" options="vm.months" per-row="3"></ac-grid>\n\n    <div ng-if="[\'1\', \'0\'].includes(vm.properties.frequency)">\n      <input ng-model="vm.properties.type" value="day" type="radio">\n      <label>on the</label>\n      <input type="number" ng-model="vm.properties.monthDay" min="1" max="31"><ng-pluralize count="vm.properties.monthDay" when="{ 1: \'st\', 2: \'nd\', 3: \'rd\', 21: \'st\', 22: \'nd\', 23: \'rd\', 31: \'st\', other: \'th\'}"></ng-pluralize>\n    </div>\n    <div ng-if="[\'1\', \'0\'].includes(vm.properties.frequency)">\n      <input ng-model="vm.properties.type" value="offset" type="radio">\n      <label>on the</label>\n      <select ng-model="vm.properties.offset">\n        <option ng-value="1">first</option>\n        <option value="2">second</option>\n        <option value="3">third</option>\n        <option value="4">fourth</option>\n        <option value="5">fifth</option>\n        <option value="-1">last</option>\n      </select>\n      <select ng-model="vm.properties.offsetPeriod">\n        <option ng-value="6">Sunday</option>\n        <option ng-value="0">Monday</option>\n        <option ng-value="1">Tuesday</option>\n        <option ng-value="2">Wednesday</option>\n        <option ng-value="3">Thursday</option>\n        <option ng-value="4">Friday</option>\n        <option ng-value="5">Saturday</option>\n        <option value="wkday">weekday</option>\n        <option value="wkend">weekend day</option>\n      </select>\n    </div>\n  </fieldset>\n</div>\n')}]),function(){function e(e){function n(){return{daysOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:[{label:"S",value:6},{label:"M",value:0},{label:"T",value:1},{label:"W",value:2},{label:"T",value:3},{label:"F",value:4},{label:"S",value:5}],shortMonths:[{label:"Jan",value:1},{label:"Feb",value:2},{label:"Mar",value:3},{label:"Apr",value:4},{label:"May",value:5},{label:"Jun",value:6},{label:"Jul",value:7},{label:"Aug",value:8},{label:"Sep",value:9},{label:"Oct",value:10},{label:"Nov",value:11},{label:"Dec",value:12}],frequencies:{3:"day",2:"week",1:"month",0:"year"}}}this.$get=n}angular.module("ac-recurrence").provider("localNames",e),e.$inject=["RRule"]}(),function(){"use strict";function e(){function e(e){var n=e||[],r={};return n.map(function(e){r[e]=!0}),r}function n(e){var n=[];for(var r in e.selections)e.selections[r]===!0&&n.push(r);return n}return{link:function(r,o,t,i){i.$formatters.push(e),i.$parsers.push(n),i.$render=function(){r.selections=i.$viewValue},r.$watch("selections",function(){var e=r.selections||{};i.$setViewValue({selections:e})},!0)},require:"ngModel",restrict:"E",scope:{ngModel:"=",options:"<",perRow:"<"},templateUrl:"ac-grid.html"}}angular.module("ac-recurrence").directive("acGrid",e)}(),function(){"use strict";function e(e,n,r,o){o.$formatters.push(function(e){e=e||"";var n;try{n=new RRule(RRule.parseString(e))}catch(e){console.log(e),n=new RRule}return n}),o.$parsers.push(function(n){return e.vm.printOut(),e.vm.rrule.toString()}),o.$render=function(){o.$viewValue.origOptions.bymonth&&(e.vm.properties.byMonth=[o.$viewValue.origOptions.bymonth]),o.$viewValue.origOptions.bymonthday?e.vm.properties.monthDay=o.$viewValue.origOptions.bymonthday:e.vm.properties.monthDay=null,e.vm.properties.frequency=String(o.$viewValue.origOptions.freq||0),e.vm.setFrequency(),e.vm.properties.interval=o.$viewValue.origOptions.interval||null;var n=o.$viewValue.origOptions.byweekday||[];n[0]&&n[0].n?(e.vm.properties.type="offset",e.vm.properties.offset=n[0].n,e.vm.properties.offsetPeriod=n[0].weekday):(e.vm.properties.type="day",e.vm.properties.offset=1,e.vm.properties.offsetPeriod=6,e.vm.properties.byWeekDay=n.map(function(e){return e.weekday}),o.$viewValue.origOptions.bysetpos&&(e.vm.properties.type="offset",e.vm.properties.offset=o.$viewValue.origOptions.bysetpos,angular.equals(e.vm.properties.byWeekDay,[5,6])?e.vm.properties.offsetPeriod="wkend":e.vm.properties.offsetPeriod="wkday"))},e.$watch("vm.properties",function(){o.$setViewValue(e.vm.rrule)},!0)}function n(){return{controller:"acRecurrenceController as vm",link:e,restrict:"E",require:"ngModel",templateUrl:"ac-recurrence.html"}}angular.module("ac-recurrence").directive("acRecurrence",n)}(),function(){"use strict";function e(e,n,r){function o(){i.word=e.frequencies[i.properties.frequency],"YEARLY"===l[i.properties.frequency]?i.preposition=" in":"WEEKLY"===l[i.properties.frequency]?i.preposition=" on":i.preposition="","WEEKLY"!==l[i.properties.frequency]&&"DAILY"!==l[i.properties.frequency]||(i.properties.type="")}function t(){var e=[];"WEEKLY"===l[i.properties.frequency]&&(e=i.properties.byWeekDay);var n=null,o=null,t=null;"YEARLY"!==l[i.properties.frequency]&&"MONTHLY"!==l[i.properties.frequency]||("offset"===i.properties.type?"wkday"===i.properties.offsetPeriod?(e.push(r.MO),e.push(r.TU),e.push(r.WE),e.push(r.TH),e.push(r.FR),n=parseInt(i.properties.offset)):"wkend"===i.properties.offsetPeriod?(e.push(r.SA),e.push(r.SU),n=parseInt(i.properties.offset)):e.push(r[p[i.properties.offsetPeriod]].nth(i.properties.offset)):o=i.properties.monthDay,"YEARLY"===l[i.properties.frequency]&&(t=i.properties.byMonth)),i.rrule=new r({freq:parseInt(i.properties.frequency),interval:i.properties.interval,bymonth:t,bymonthday:o,bysetpos:n,byweekday:e})}var i=this;i.properties={},i.months=e.shortMonths,i.days=e.shortDays,i.printOut=t,i.rrule="",i.setFrequency=o,i.preposition=" in",i.word="year";var l={0:"YEARLY",1:"MONTHLY",2:"WEEKLY",3:"DAILY"},p={0:"MO",1:"TU",2:"WE",3:"TH",4:"FR",5:"SA",6:"SU"}}e.$inject=["localNames","$filter","RRule"],angular.module("ac-recurrence").controller("acRecurrenceController",e)}();